import{c as C,r as c,j as t,B as H,m as S,S as fe,R as ye,T as ke,K as oe,C as be,X as we,L as Ne}from"./index-BF0z3Gyh.js";import{L as se}from"./list-checks-D6X32GDJ.js";import{A as ve}from"./arrow-left-DVi92Pj8.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ne=C("check",je);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ce=C("circle-x",Se);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Me=C("plus",Te);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Be=C("rotate-ccw",De);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Ie=C("save",_e);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]],Re=C("skip-forward",Le);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],$e=C("trash-2",Ee);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Ae=C("volume-2",ze),W=[{name:"Thông báo 1",url:"/marcusfi-website/sound/ntf-snd-01.mp3"},{name:"Thông báo 2",url:"/marcusfi-website/sound/ntf-snd-02.mp3"},{name:"Thông báo 3",url:"/marcusfi-website/sound/ntf-snd-03.mp3"},{name:"Thông báo 4",url:"/marcusfi-website/sound/ntf-snd-04.mp3"},{name:"Thông báo 5",url:"/marcusfi-website/sound/ntf-snd-05.mp3"},{name:"Thông báo 6",url:"/marcusfi-website/sound/ntf-snd-06.mp3"}],B=[{id:"local_track1",title:"Nhạc Nền 1",src:"/marcusfi-website/music1.mp3"},{id:"local_track2",title:"Nhạc Nền 2",src:"/marcusfi-website/music2.mp3"},{id:"local_track3",title:"Nhạc Nền 3",src:"/marcusfi-website/music3.mp3"},{id:"local_track4",title:"Nhạc Nền 4",src:"/marcusfi-website/music4.mp3"},{id:"local_track5",title:"Nhạc Nền 5",src:"/marcusfi-website/music5.mp3"},{id:"local_track6",title:"Nhạc Nền 6",src:"/marcusfi-website/music6.mp3"},{id:"local_track7",title:"Nhạc Nền 7",src:"/marcusfi-website/music7.mp3"},{id:"local_track8",title:"Nhạc Nền 8",src:"/marcusfi-website/music8.mp3"},{id:"local_track9",title:"Nhạc Nền 9",src:"/marcusfi-website/music9.mp3"},{id:"local_track10",title:"Nhạc Nền 10",src:"/marcusfi-website/music10.mp3"}],R={workDuration:25,shortBreakDuration:5,longBreakDuration:15,cyclesBeforeLongBreak:4,includeMusic:!1,alarmSoundRepeat:1,darkModeOnStart:!0,selectedNotificationSound:W[0].url,currentMusicTrackIndex:0},Fe=({isOpen:w,onClose:s,currentSettings:v,onSaveSettings:x})=>{const[g,d]=c.useState(v),k=c.useRef(null);c.useEffect(()=>{d(v)},[v]);const i=(o,y)=>{let f=y;if(typeof y=="string"&&(o==="workDuration"||o==="shortBreakDuration"||o==="longBreakDuration"||o==="cyclesBeforeLongBreak"||o==="alarmSoundRepeat")){let b=parseInt(y,10);(isNaN(b)||b<1)&&(b=1),f=b}o==="alarmSoundRepeat"&&typeof f=="number"?f=Math.max(1,Math.min(5,f)):(o==="workDuration"||o==="shortBreakDuration"||o==="longBreakDuration"||o==="cyclesBeforeLongBreak")&&typeof f=="number"&&(f=Math.max(1,f)),d(b=>({...b,[o]:f}))},E=()=>{x(g),s()},T=()=>{k.current||(k.current=new Audio);const o=new URL(g.selectedNotificationSound,window.location.origin).href;k.current.src=o,k.current.play().catch(y=>console.error("Lỗi nghe thử âm báo:",y.name,y.message))};if(!w)return null;const $=[{label:"Pomodoro",field:"workDuration"},{label:"Short Break",field:"shortBreakDuration"},{label:"Long Break",field:"longBreakDuration"}];return t.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",onClick:s,children:t.jsxs(S.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 p-5 sm:p-6 rounded-xl shadow-2xl w-full max-w-md",onClick:o=>o.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Cài đặt Timer"}),t.jsx("button",{onClick:s,className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:t.jsx(we,{size:20})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400 mb-1",children:[t.jsx(oe,{size:16,className:"mr-1.5"}),t.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider",children:"TIMER"})]}),t.jsx("label",{className:"block text-sm font-semibold text-gray-800 dark:text-gray-100 mb-1.5",children:"Time (minutes)"}),t.jsx("div",{className:"grid grid-cols-3 gap-x-3",children:$.map(o=>t.jsxs("div",{children:[t.jsx("label",{htmlFor:o.field,className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:o.label}),t.jsx("input",{type:"number",id:o.field,min:"1",value:g[o.field],onChange:y=>i(o.field,y.target.value),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-center"})]},o.field))})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notificationSound",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:"Âm thanh thông báo"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("select",{id:"notificationSound",value:g.selectedNotificationSound,onChange:o=>i("selectedNotificationSound",o.target.value),className:"flex-grow px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100",children:W.map(o=>t.jsx("option",{value:o.url,children:o.name},o.url))}),t.jsx("button",{onClick:T,title:"Nghe thử",className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors",children:t.jsx(Ae,{size:18})})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-x-3",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"cyclesBeforeLongBreak",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:"Chu kỳ / Nghỉ dài"}),t.jsx("input",{type:"number",id:"cyclesBeforeLongBreak",min:"1",value:g.cyclesBeforeLongBreak,onChange:o=>i("cyclesBeforeLongBreak",o.target.value),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-center"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"alarmRepeat",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:"Số lần lặp âm báo (1-5)"}),t.jsx("input",{type:"number",id:"alarmRepeat",min:"1",max:"5",value:g.alarmSoundRepeat,onChange:o=>i("alarmSoundRepeat",o.target.value),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-center"})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-2 space-x-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"modalIncludeMusic",checked:g.includeMusic,onChange:o=>i("includeMusic",o.target.checked),className:"h-4 w-4 text-purple-600 focus:ring-offset-0 focus:ring-1 focus:ring-purple-500 border-gray-300 dark:border-gray-600 rounded"}),t.jsx("label",{htmlFor:"modalIncludeMusic",className:"ml-2 block text-sm text-gray-700 dark:text-gray-200",children:"Nhạc nền (Work mode)"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"modalDarkModeOnStart",checked:g.darkModeOnStart,onChange:o=>i("darkModeOnStart",o.target.checked),className:"h-4 w-4 text-purple-600 focus:ring-offset-0 focus:ring-1 focus:ring-purple-500 border-gray-300 dark:border-gray-600 rounded"}),t.jsx("label",{htmlFor:"modalDarkModeOnStart",className:"ml-2 block text-sm text-gray-700 dark:text-gray-200",children:"Dark Mode khi Start (Work)"})]})]})]}),t.jsx("button",{onClick:E,className:"w-full mt-6 py-2.5 px-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:"Lưu Cài Đặt"})]})})},Oe=({isOpen:w,taskName:s,onMarkAsCompleted:v,onDeletePermanently:x,onCancel:g})=>w?t.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",onClick:g,children:t.jsxs(S.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 p-5 sm:p-6 rounded-lg shadow-xl w-full max-w-xs text-center",onClick:d=>d.stopPropagation(),children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Hoàn Thành Công Việc!"}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-5",children:["Tuyệt vời! Bạn đã hoàn thành: ",t.jsxs("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:['"',s,'"']}),".",t.jsx("br",{}),"Chọn hành động tiếp theo:"]}),t.jsxs("div",{className:"space-y-2.5",children:[t.jsx("button",{onClick:v,className:"w-full px-4 py-2 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600 transition",children:"Đánh dấu Hoàn thành"}),t.jsxs("button",{onClick:x,className:"w-full px-4 py-2 text-sm bg-red-500 text-white rounded-md hover:bg-red-600 transition flex items-center justify-center",children:[t.jsx($e,{size:16,className:"mr-2"})," Xoá khỏi danh sách"]}),t.jsx("button",{onClick:g,className:"w-full mt-1 py-1 text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:"Để sau"})]})]})}):null,Pe=({setIsPageInFocusMode:w})=>{const[s,v]=c.useState(()=>{const e=localStorage.getItem("timerSettings_v2");try{if(e){const r=JSON.parse(e);return{...R,...r,selectedNotificationSound:r.selectedNotificationSound&&W.some(a=>a.url===r.selectedNotificationSound)?r.selectedNotificationSound:R.selectedNotificationSound,currentMusicTrackIndex:typeof r.currentMusicTrackIndex=="number"&&r.currentMusicTrackIndex>=0&&r.currentMusicTrackIndex<B.length?r.currentMusicTrackIndex:R.currentMusicTrackIndex,alarmSoundRepeat:typeof r.alarmSoundRepeat=="number"?Math.max(1,Math.min(5,r.alarmSoundRepeat)):R.alarmSoundRepeat}}}catch(r){console.error("Lỗi parse settings từ localStorage:",r)}return R}),[x,g]=c.useState(s.workDuration*60),[d,k]=c.useState(!1),[i,E]=c.useState("work"),[T,$]=c.useState(0),[o,y]=c.useState(!1),[f,b]=c.useState(!1),[j,M]=c.useState(()=>{const e=localStorage.getItem("timerTasks_v2");if(e)try{const r=JSON.parse(e);if(Array.isArray(r))return r.map(a=>{let l="in_progress";return a.status==="in_progress"||a.status==="completed"?l=a.status:a.status==="hidden"&&(l="completed"),{id:String(a.id||Date.now()+Math.random()),name:String(a.name||"Công việc không tên"),status:l,cyclesCompleted:typeof a.cyclesCompleted=="number"?a.cyclesCompleted:0,estimatedCycles:typeof a.estimatedCycles=="number"&&a.estimatedCycles>0?a.estimatedCycles:1}}).filter(a=>a!==null&&typeof a.id=="string"&&typeof a.name=="string"&&(a.status==="in_progress"||a.status==="completed")&&typeof a.cyclesCompleted=="number"&&typeof a.estimatedCycles=="number")}catch(r){return console.error("Lỗi khi parse tasks từ localStorage:",r),[]}return[]}),[V,Q]=c.useState(""),[q,Y]=c.useState(1),[u,z]=c.useState(()=>{const e=localStorage.getItem("timerActiveTaskId");if(e&&e!=="undefined"&&e!=="null")try{const r=JSON.parse(e);return typeof r=="string"?r:null}catch(r){return console.error("Lỗi parse activeTaskId:",r),null}return null});c.useEffect(()=>{u&&(j.some(r=>r.id===u&&r.status==="in_progress")||z(null))},[j,u]);const[p,ie]=c.useState(!1),[ce,J]=c.useState(!1),[N,A]=c.useState(null),[G,le]=c.useState(!0),m=c.useRef(null),h=c.useRef(null),F=c.useRef(),O=c.useRef(0),Z=c.useRef(!1);c.useEffect(()=>{localStorage.setItem("timerSettings_v2",JSON.stringify(s))},[s]),c.useEffect(()=>{localStorage.setItem("timerTasks_v2",JSON.stringify(j))},[j]),c.useEffect(()=>{u===null?localStorage.removeItem("timerActiveTaskId"):localStorage.setItem("timerActiveTaskId",JSON.stringify(u))},[u]),c.useEffect(()=>{const e=d&&s.darkModeOnStart&&i==="work";e!==p&&(ie(e),w(e),e||J(!1))},[d,s.darkModeOnStart,i,w,p]),c.useEffect(()=>{if(h.current&&s.selectedNotificationSound){const e=new URL(s.selectedNotificationSound,window.location.origin).href;h.current.src!==e&&(h.current.src=e,h.current.load())}},[s.selectedNotificationSound]);const ee=c.useCallback(()=>{if(!h.current||s.alarmSoundRepeat<=0){console.log("[Notification] Skipped: No audio element or repeat count is zero.");return}const e=h.current,r=new URL(s.selectedNotificationSound,window.location.origin).href;e.src!==r&&(e.src=r,e.load()),O.current=0;const n=()=>{O.current<s.alarmSoundRepeat?(e.pause(),e.currentTime=0,e.play().then(()=>{}).catch(l=>{console.error("[Notification] Lỗi phát âm báo:",l.name,l.message,`(Attempt: ${O.current+1})`),e.removeEventListener("ended",a)})):e.removeEventListener("ended",a)},a=()=>{O.current++,n()};e.removeEventListener("ended",a),e.addEventListener("ended",a),n()},[s.selectedNotificationSound,s.alarmSoundRepeat]),te=c.useCallback(()=>{ee(),m.current&&!m.current.paused&&m.current.pause();let e,r=T,n;i==="work"?(u&&M(a=>a.map(l=>l.id===u?{...l,cyclesCompleted:l.cyclesCompleted+1}:l)),r=T+1,r>=s.cyclesBeforeLongBreak?(e="long_break",n=s.longBreakDuration*60,$(0)):(e="short_break",n=s.shortBreakDuration*60,$(r)),typeof Notification<"u"&&Notification.permission==="granted"?new Notification("Đến giờ giải lao rồi!",{body:`Hãy đứng dậy, di chuyển hoặc thư giãn một chút nhé. ${e==="short_break"?"Nghỉ ngắn":"Nghỉ dài"} sắp bắt đầu.`,icon:"/marcusfi-website/favicon.ico"}):typeof Notification<"u"&&Notification.permission!=="denied"&&Notification.requestPermission().then(a=>{a==="granted"&&new Notification("Đến giờ giải lao rồi!",{body:`Hãy đứng dậy, di chuyển hoặc thư giãn một chút nhé. ${e==="short_break"?"Nghỉ ngắn":"Nghỉ dài"} sắp bắt đầu.`,icon:"/marcusfi-website/favicon.ico"})})):(e="work",n=s.workDuration*60),k(!1),E(e),g(n)},[u,T,s,ee,i,M]);c.useEffect(()=>(d&&x>0?F.current=window.setInterval(()=>{g(e=>e<=1?(clearInterval(F.current),te(),0):e-1)},1e3):(!d||x===0)&&clearInterval(F.current),()=>{clearInterval(F.current)}),[d,x,te]),c.useEffect(()=>{const e=m.current;if(!e)return;const r=()=>{const n=(s.currentMusicTrackIndex+1)%B.length;v(a=>({...a,currentMusicTrackIndex:n}))};if(e.removeEventListener("ended",r),e.addEventListener("ended",r),s.includeMusic&&i==="work"){const n=B[s.currentMusicTrackIndex];if(!n){e.paused||e.pause();return}const a=new URL(n.src,window.location.origin).href;let l=!1;if(e.src!==a&&(e.src=a,e.load(),l=!0),d){if(l||e.paused){const I=e.play();I!==void 0&&I.catch(U=>console.error("Lỗi phát nhạc nền (useEffect):",U.name,U.message))}}else e.paused||e.pause()}else e.paused||e.pause();return()=>{e.removeEventListener("ended",r)}},[d,i,s.includeMusic,s.currentMusicTrackIndex]);const de=()=>{if(i==="work"&&!u){alert("Vui lòng chọn một công việc để bắt đầu phiên làm việc.");return}if(x===0){let e;i==="work"?e=s.workDuration*60:i==="short_break"?e=s.shortBreakDuration*60:e=s.longBreakDuration*60,g(e)}if(!Z.current){if(h.current){const e=h.current;if(!e.src&&s.selectedNotificationSound&&(e.src=new URL(s.selectedNotificationSound,window.location.origin).href,e.load()),e.src&&e.readyState>=2){const r=e.muted;e.muted=!0,e.play().then(()=>{e.pause(),e.currentTime=0,e.muted=r}).catch(()=>{e.muted=r})}}if(m.current&&s.includeMusic){const e=m.current,r=B[s.currentMusicTrackIndex];if(r&&!e.src&&(e.src=new URL(r.src,window.location.origin).href,e.load()),e.src&&e.readyState>=2){const n=e.muted;e.muted=!0,e.play().then(()=>{e.pause(),e.currentTime=0,e.muted=n}).catch(()=>{e.muted=n})}}Z.current=!0}if(s.includeMusic&&i==="work"&&m.current){const e=m.current,r=B[s.currentMusicTrackIndex];if(r){const n=new URL(r.src,window.location.origin).href;if(e.src!==n)e.src=n,e.load(),setTimeout(()=>{const a=e.play();a!==void 0&&a.catch(l=>console.error("Lỗi phát nhạc nền (handleStart, src changed):",l.name,l.message))},100);else if(e.paused){const a=e.play();a!==void 0&&a.catch(l=>console.error("Lỗi phát nhạc nền (handleStart, paused):",l.name,l.message))}}}k(!0)},K=()=>{k(!1),m.current&&!m.current.paused&&m.current.pause()},ue=()=>{k(!1);let e;i==="work"?e=s.workDuration*60:i==="short_break"?e=s.shortBreakDuration*60:e=s.longBreakDuration*60,g(e),m.current&&!m.current.paused&&m.current.pause()},me=()=>{i!=="work"&&(k(!1),E("work"),g(s.workDuration*60))},ge=()=>{if(V.trim()){const e={id:String(Date.now()+Math.random()),name:V.trim(),status:"in_progress",cyclesCompleted:0,estimatedCycles:q>0?q:1};M(r=>[...r,e].sort(_)),Q(""),Y(1),b(!1)}},_=(e,r)=>{const n={in_progress:1,completed:2};return n[e.status]!==n[r.status]?n[e.status]-n[r.status]:0},re=e=>{const r=j.find(n=>n.id===e);r&&(r.status==="in_progress"?A(r):r.status==="completed"&&M(n=>n.map(a=>a.id===e?{...a,status:"in_progress"}:a).sort(_)))},pe=()=>{N&&(M(e=>e.map(r=>r.id===N.id?{...r,status:"completed"}:r).sort(_)),u===N.id&&(z(null),d&&i==="work"&&K()),A(null))},xe=()=>{N&&(M(e=>e.filter(r=>r.id!==N.id)),u===N.id&&(z(null),d&&i==="work"&&K()),A(null))},he=e=>{const r=Math.floor(e/60),n=e%60;return`${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},ae=e=>{if(!e||e.status==="completed")return"Hoàn thành";const r=e.cyclesCompleted,n=e.estimatedCycles-r;if(n<=0)return"Sắp xong!";let a=0,l=0;(u===e.id&&i==="work"&&d||u===e.id&&i==="work"&&!d&&x<s.workDuration*60)&&(l=(s.workDuration*60-x)/60,l=Math.max(0,Math.min(l,s.workDuration-1/60)));for(let L=0;L<n;L++)L===0?a+=Math.max(0,s.workDuration-l):a+=s.workDuration,L<n-1&&((T+L)%s.cyclesBeforeLongBreak===s.cyclesBeforeLongBreak-1?a+=s.longBreakDuration:a+=s.shortBreakDuration);const I=new Date(Date.now()+a*60*1e3),U={day:"2-digit",month:"2-digit"};return I.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})+", "+I.toLocaleDateString("vi-VN",U)},D=u?j.find(e=>e.id===u):null,X=j.filter(e=>e.status==="in_progress").sort(_),P=j.filter(e=>e.status==="completed").sort(_);return t.jsxs("div",{className:`max-w-xl mx-auto p-4 sm:p-6 rounded-2xl shadow-xl transition-all duration-300 ease-in-out relative
             ${p?"bg-black min-h-[380px] sm:min-h-[420px] flex flex-col justify-center items-center":"bg-gray-50 dark:bg-gray-800"}`,onMouseEnter:()=>{p&&J(!0)},onMouseLeave:()=>{p&&J(!1)},children:[t.jsx(H,{children:!p&&t.jsx(S.div,{initial:{opacity:1},exit:{opacity:0},className:"mb-4 text-center",children:t.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center text-sm text-gray-500 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors py-1.5 px-2.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent hover:border-gray-200 dark:hover:border-gray-600",children:[t.jsx(fe,{size:15,className:"mr-1.5"}),"Cài đặt Timer"]})})}),t.jsxs("div",{className:`text-center transition-opacity duration-300 ${o?"opacity-10 pointer-events-none":"opacity-100"}`,children:[t.jsx(H,{mode:"wait",children:t.jsx(S.h2,{initial:{opacity:0,y:p?0:-10},animate:{opacity:p?0:1,y:0},exit:{opacity:0,y:p?0:10},transition:{duration:.25},className:`text-3xl sm:text-4xl font-bold mb-2
                            ${p?"h-0 overflow-hidden pointer-events-none":i==="work"?"text-gray-800 dark:text-gray-100":i==="short_break"?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"}`,children:i==="work"?"Thời Gian Tập Trung":i==="short_break"?"Nghỉ Ngắn":"Nghỉ Dài"},i)}),t.jsx("div",{className:`text-6xl font-mono font-bold mb-4 ${p?"text-white":"text-purple-600 dark:text-purple-400"}`,children:he(x)}),t.jsxs("div",{className:`flex justify-center space-x-3 sm:space-x-4 mb-6 transition-opacity duration-300
                     ${p&&!ce?"opacity-0 pointer-events-none":"opacity-100"}`,children:[t.jsx("button",{onClick:d?K:de,disabled:!d&&i==="work"&&!u,className:`p-3 rounded-full text-white transition-all duration-200 ease-in-out transform hover:scale-105
                       ${d?"bg-red-500 hover:bg-red-600 shadow-md":"bg-purple-600 hover:bg-purple-700 shadow-md"}
                       ${!d&&i==="work"&&!u?"opacity-50 cursor-not-allowed":""}
                       ${p?d?"bg-red-500/70 hover:bg-red-600/90":"bg-purple-600/70 hover:bg-purple-500/90":""}
                      `,title:!d&&i==="work"&&!u?"Vui lòng chọn công việc":d?"Tạm dừng":"Bắt đầu",children:d?t.jsx(ye,{size:24}):t.jsx(ke,{size:24})}),t.jsx("button",{onClick:ue,className:`p-3 rounded-full transition-colors transform hover:scale-105 shadow-sm
                       ${p?"bg-gray-600/60 hover:bg-gray-500/80 text-gray-200":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"}
                      `,children:t.jsx(Be,{size:24})}),i!=="work"&&!d&&t.jsx("button",{onClick:me,className:`p-3 rounded-full text-white transition-colors transform hover:scale-105 shadow-sm
                         ${p?"bg-amber-600/60 hover:bg-amber-500/80":"bg-amber-500 hover:bg-amber-600"}
                        `,children:t.jsx(Re,{size:24})})]})]}),p&&D&&t.jsxs("div",{className:"mt-4 sm:mt-6 text-center absolute bottom-6 left-1/2 -translate-x-1/2 w-full px-4",children:[t.jsx("p",{className:"text-lg sm:text-xl text-white font-semibold truncate",title:D.name,children:D.name}),t.jsxs("p",{className:"text-xs sm:text-sm text-gray-400 mt-1",children:[D.cyclesCompleted," / ",D.estimatedCycles," sessions - Dự kiến: ",ae(D)]})]}),t.jsxs("div",{className:`border-t border-gray-200 dark:border-gray-700 pt-6 mt-4 transition-opacity duration-300 ${p||o?"opacity-10 pointer-events-none h-0 overflow-hidden":"opacity-100"}`,children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Công việc của bạn"}),!f&&t.jsx("button",{onClick:()=>b(!0),className:"p-1.5 text-purple-600 dark:text-purple-400 hover:bg-purple-100 dark:hover:bg-gray-700 rounded-full transition-colors",title:"Thêm công việc mới",children:t.jsx(Me,{size:20})})]}),t.jsx(H,{children:f&&t.jsxs(S.form,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},onSubmit:e=>{e.preventDefault(),ge()},className:"flex flex-col sm:flex-row gap-2 mb-4 items-end p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 shadow-sm",children:[t.jsxs("div",{className:"flex-1 w-full sm:w-auto",children:[t.jsx("label",{htmlFor:"newTaskName",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-0.5",children:"Tên công việc"}),t.jsx("input",{type:"text",id:"newTaskName",value:V,onChange:e=>Q(e.target.value),placeholder:"Thêm công việc mới...",className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-purple-500 dark:focus:border-purple-400 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100"})]}),t.jsxs("div",{className:"w-full sm:w-20",children:[t.jsx("label",{htmlFor:"newTaskCycles",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-0.5",children:"Cycles"}),t.jsx("input",{type:"number",id:"newTaskCycles",min:"1",value:q,onChange:e=>Y(Number(e.target.value)),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-purple-500 dark:focus:border-purple-400 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100"})]}),t.jsxs("div",{className:"flex gap-2 w-full sm:w-auto mt-2 sm:mt-0",children:[t.jsxs("button",{type:"submit",className:"flex-1 sm:flex-none px-3 py-1.5 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors self-end h-[34px] text-sm flex items-center justify-center gap-1",children:[t.jsx(Ie,{size:16})," Lưu"]}),t.jsxs("button",{type:"button",onClick:()=>b(!1),className:"flex-1 sm:flex-none px-3 py-1.5 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors self-end h-[34px] text-sm flex items-center justify-center gap-1",children:[t.jsx(Ce,{size:16})," Hủy"]})]})]})}),X.length>0&&t.jsx("div",{className:"text-sm mb-2 text-gray-500 dark:text-gray-400 font-medium",children:"Đang thực hiện:"}),t.jsxs("div",{className:"space-y-2",children:[X.length===0&&P.length===0&&!f&&t.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-3 italic",children:"Chưa có công việc nào. Nhấn + để thêm."}),X.map(e=>t.jsxs("div",{className:`p-3 rounded-lg border transition-all duration-200 
                ${u===e.id?"bg-purple-50 dark:bg-purple-900/30 border-purple-500 dark:border-purple-600 shadow-lg ring-1 ring-purple-500 dark:ring-purple-600":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2.5 flex-1 min-w-0",children:[t.jsx("button",{onClick:()=>re(e.id),className:"p-1.5 rounded-full transition-colors flex-shrink-0 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-500 dark:text-gray-400",children:t.jsx(ne,{size:14})}),t.jsx("span",{className:"text-sm truncate text-gray-800 dark:text-gray-100",title:e.name,children:e.name})]}),t.jsx("button",{onClick:()=>{e.status==="in_progress"&&z(u===e.id?null:e.id)},disabled:e.status!=="in_progress",className:`px-2.5 py-1 rounded-full text-xs font-medium transition-all whitespace-nowrap ${u===e.id?"bg-purple-600 text-white shadow-sm":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-purple-100 dark:hover:bg-purple-800/50 hover:text-purple-700 dark:hover:text-purple-300"}`,children:u===e.id?"Đang làm":"Chọn làm"})]}),t.jsxs("div",{className:"mt-2.5 flex flex-col sm:flex-row items-start sm:items-center justify-between text-xs text-gray-500 dark:text-gray-400 pl-9 space-y-1 sm:space-y-0",children:[t.jsxs("span",{className:"flex items-center",title:"Số chu kỳ đã hoàn thành / Số chu kỳ dự kiến",children:[t.jsx(se,{size:14,className:"mr-1 text-blue-500 dark:text-blue-400 flex-shrink-0"}),e.cyclesCompleted," / ",e.estimatedCycles," cycles"]}),e.status==="in_progress"&&e.estimatedCycles>e.cyclesCompleted&&t.jsxs("span",{className:"flex items-center",title:"Thời gian dự kiến hoàn thành",children:[t.jsx(oe,{size:14,className:"mr-1 text-orange-500 dark:text-orange-400 flex-shrink-0"}),"Dự kiến: ",ae(e)]})]})]},e.id))]}),P.length>0&&t.jsxs("div",{className:"mt-5 pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("button",{onClick:()=>le(!G),className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-purple-600 dark:hover:text-purple-400 flex items-center w-full justify-between py-1",children:[t.jsxs("span",{children:["Công việc đã hoàn thành (",P.length,")"]}),t.jsx(be,{size:18,className:`transition-transform ${G?"rotate-180":""}`})]}),t.jsx(H,{children:G&&t.jsx(S.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mt-2 space-y-2",children:P.map(e=>t.jsxs("div",{className:"p-3 rounded-lg border opacity-70 bg-gray-100 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2.5 flex-1 min-w-0",children:[t.jsx("button",{onClick:()=>re(e.id),className:"p-1.5 rounded-full transition-colors flex-shrink-0 bg-green-500 hover:bg-green-600 text-white",children:t.jsx(ne,{size:14})}),t.jsx("span",{className:"text-sm truncate line-through text-gray-500 dark:text-gray-400",title:e.name,children:e.name})]}),t.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 cursor-default whitespace-nowrap",children:"Đã xong"})]}),t.jsxs("div",{className:"mt-2 flex items-center text-xs text-gray-400 dark:text-gray-500 pl-9",children:[t.jsx(se,{size:14,className:"mr-1 text-blue-400 dark:text-blue-500 flex-shrink-0"}),"Hoàn thành ",e.cyclesCompleted," / ",e.estimatedCycles," cycles"]})]},e.id))})})]})]}),t.jsx("audio",{ref:m,loop:!1}),t.jsx("audio",{ref:h}),t.jsx(Fe,{isOpen:o,onClose:()=>y(!1),currentSettings:s,onSaveSettings:e=>{const r=s;if(v(e),!d){let n=x,a=!1;i==="work"&&r.workDuration!==e.workDuration?(n=e.workDuration*60,a=!0):i==="short_break"&&r.shortBreakDuration!==e.shortBreakDuration?(n=e.shortBreakDuration*60,a=!0):i==="long_break"&&r.longBreakDuration!==e.longBreakDuration&&(n=e.longBreakDuration*60,a=!0),a&&g(n)}if(m.current&&(r.includeMusic&&!e.includeMusic&&!m.current.paused&&m.current.pause(),e.includeMusic&&m.current&&(r.currentMusicTrackIndex!==e.currentMusicTrackIndex||!m.current.src))){const n=B[e.currentMusicTrackIndex];if(n){const a=new URL(n.src,window.location.origin).href;m.current.src!==a&&(m.current.src=a,m.current.load())}}if(h.current&&r.selectedNotificationSound!==e.selectedNotificationSound){const n=new URL(e.selectedNotificationSound,window.location.origin).href;h.current.src!==n&&(h.current.src=n,h.current.load())}}}),N&&t.jsx(Oe,{isOpen:!!N,taskName:N.name,onMarkAsCompleted:pe,onDeletePermanently:xe,onCancel:()=>A(null)})]})},Je=()=>{const[w,s]=c.useState(!1);return t.jsx("div",{className:`min-h-screen py-12 sm:py-16 md:py-20 transition-colors duration-300 ease-in-out
                  ${w?"bg-black":"bg-gradient-to-br from-purple-50 via-white to-blue-50"}`,children:t.jsxs("div",{className:"container mx-auto px-4",children:[t.jsx("div",{className:`text-center mb-8 sm:mb-10 transition-opacity duration-300 ${w?"opacity-0 h-0 overflow-hidden pointer-events-none":"opacity-100"}`,children:t.jsxs("div",{className:"relative max-w-xl mx-auto",children:[t.jsxs(Ne,{to:"/",className:"absolute left-0 top-1/2 -translate-y-1/2 flex items-center text-xs sm:text-sm text-purple-600 hover:text-purple-800 transition-colors group py-2 pr-2",children:[t.jsx(ve,{size:16,className:"mr-1 transition-transform group-hover:-translate-x-0.5"}),"Trang chủ"]}),t.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-800",children:"Timer Block"})]})}),t.jsx(Pe,{setIsPageInFocusMode:s})]})})};export{Je as default};
