import{c as S,r as o,j as t,B as O,m as j,S as he,Q as fe,R as ye,K as be,C as ke,X as Ne,L as ve}from"./index-qnCZGlJq.js";import{L as re}from"./list-checks-6cDTqREy.js";import{A as we}from"./arrow-left-BwwNfuDD.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],se=S("check",je);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Ce=S("circle-x",Se);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Me=S("plus",Te);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],De=S("rotate-ccw",_e);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Re=S("save",Ie);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]],Be=S("skip-forward",Le);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Ee=S("trash-2",$e);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],ze=S("volume-2",Ae),F=[{name:"Thông báo 1",url:"/marcusfi-website/sound/ntf-snd-01.mp3"},{name:"Thông báo 2",url:"/marcusfi-website/sound/ntf-snd-02.mp3"},{name:"Thông báo 3",url:"/marcusfi-website/sound/ntf-snd-03.mp3"},{name:"Thông báo 4",url:"/marcusfi-website/sound/ntf-snd-04.mp3"},{name:"Thông báo 5",url:"/marcusfi-website/sound/ntf-snd-05.mp3"},{name:"Thông báo 6",url:"/marcusfi-website/sound/ntf-snd-06.mp3"}],K=[{id:"local_track1",title:"Nhạc Nền 1",src:"/marcusfi-website/music1.mp3"},{id:"local_track2",title:"Nhạc Nền 2",src:"/marcusfi-website/music2.mp3"},{id:"local_track3",title:"Nhạc Nền 3",src:"/marcusfi-website/music3.mp3"},{id:"local_track4",title:"Nhạc Nền 4",src:"/marcusfi-website/music4.mp3"},{id:"local_track5",title:"Nhạc Nền 5",src:"/marcusfi-website/music5.mp3"},{id:"local_track6",title:"Nhạc Nền 6",src:"/marcusfi-website/music6.mp3"},{id:"local_track7",title:"Nhạc Nền 7",src:"/marcusfi-website/music7.mp3"},{id:"local_track8",title:"Nhạc Nền 8",src:"/marcusfi-website/music8.mp3"},{id:"local_track9",title:"Nhạc Nền 9",src:"/marcusfi-website/music9.mp3"},{id:"local_track10",title:"Nhạc Nền 10",src:"/marcusfi-website/music10.mp3"}],L={workDuration:25,shortBreakDuration:5,longBreakDuration:15,cyclesBeforeLongBreak:4,includeMusic:!1,alarmSoundRepeat:1,darkModeOnStart:!0,selectedNotificationSound:F[0].url,currentMusicTrackIndex:0},Oe=({isOpen:f,onClose:s,currentSettings:y,onSaveSettings:b})=>{const[u,l]=o.useState(y),h=o.useRef(null);o.useEffect(()=>{l(y)},[y]);const c=(n,p)=>{let g=p;typeof p=="string"&&(n==="workDuration"||n==="shortBreakDuration"||n==="longBreakDuration"||n==="cyclesBeforeLongBreak"||n==="alarmSoundRepeat")&&(g=parseInt(p,10),(isNaN(g)||g<1)&&(g=1)),n==="alarmSoundRepeat"?g=Math.max(1,Math.min(5,Number(g))):n!=="includeMusic"&&n!=="darkModeOnStart"&&n!=="selectedNotificationSound"&&n!=="currentMusicTrackIndex"&&typeof g=="number"&&(g=Math.max(1,Number(g))),l(D=>({...D,[n]:g}))},B=()=>{b(u),s()},C=()=>{h.current||(h.current=new Audio);const n=new URL(u.selectedNotificationSound,window.location.origin).href;h.current.src=n,h.current.play().catch(p=>console.error("Lỗi nghe thử âm báo:",p.name,p.message))};return f?t.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",onClick:s,children:t.jsxs(j.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 p-5 sm:p-6 rounded-xl shadow-2xl w-full max-w-md",onClick:n=>n.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Cài đặt Timer"}),t.jsx("button",{onClick:s,className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:t.jsx(Ne,{size:20})})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("div",{className:"grid grid-cols-2 gap-x-3 gap-y-3",children:[{label:"Tập trung (phút)",field:"workDuration",value:u.workDuration},{label:"Nghỉ ngắn (phút)",field:"shortBreakDuration",value:u.shortBreakDuration},{label:"Nghỉ dài (phút)",field:"longBreakDuration",value:u.longBreakDuration},{label:"Chu kỳ / Nghỉ dài",field:"cyclesBeforeLongBreak",value:u.cyclesBeforeLongBreak}].map(n=>t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:n.label}),t.jsx("input",{type:"number",min:"1",value:n.value,onChange:p=>c(n.field,p.target.value),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100"})]},n.field))}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"alarmRepeat",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:"Số lần lặp âm báo (1-5)"}),t.jsx("input",{type:"number",id:"alarmRepeat",min:"1",max:"5",value:u.alarmSoundRepeat,onChange:n=>c("alarmSoundRepeat",n.target.value),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notificationSound",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:"Âm thanh thông báo"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("select",{id:"notificationSound",value:u.selectedNotificationSound,onChange:n=>c("selectedNotificationSound",n.target.value),className:"flex-grow px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100",children:F.map(n=>t.jsx("option",{value:n.url,children:n.name},n.url))}),t.jsx("button",{onClick:C,title:"Nghe thử",className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors",children:t.jsx(ze,{size:18})})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-2 space-x-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"modalIncludeMusic",checked:u.includeMusic,onChange:n=>c("includeMusic",n.target.checked),className:"h-4 w-4 text-purple-600 focus:ring-offset-0 focus:ring-1 focus:ring-purple-500 border-gray-300 dark:border-gray-600 rounded"}),t.jsx("label",{htmlFor:"modalIncludeMusic",className:"ml-2 block text-sm text-gray-700 dark:text-gray-200",children:"Nhạc nền (Work mode)"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"modalDarkModeOnStart",checked:u.darkModeOnStart,onChange:n=>c("darkModeOnStart",n.target.checked),className:"h-4 w-4 text-purple-600 focus:ring-offset-0 focus:ring-1 focus:ring-purple-500 border-gray-300 dark:border-gray-600 rounded"}),t.jsx("label",{htmlFor:"modalDarkModeOnStart",className:"ml-2 block text-sm text-gray-700 dark:text-gray-200",children:"Dark Mode khi Start (Work)"})]})]})]}),t.jsx("button",{onClick:B,className:"w-full mt-5 py-2.5 px-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:"Lưu Cài Đặt"})]})}):null},Fe=({isOpen:f,taskName:s,onMarkAsCompleted:y,onDeletePermanently:b,onCancel:u})=>f?t.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",onClick:u,children:t.jsxs(j.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 p-5 sm:p-6 rounded-lg shadow-xl w-full max-w-xs text-center",onClick:l=>l.stopPropagation(),children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Hoàn Thành Công Việc!"}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-5",children:["Tuyệt vời! Bạn đã hoàn thành: ",t.jsxs("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:['"',s,'"']}),".",t.jsx("br",{}),"Chọn hành động tiếp theo:"]}),t.jsxs("div",{className:"space-y-2.5",children:[t.jsx("button",{onClick:y,className:"w-full px-4 py-2 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600 transition",children:"Đánh dấu Hoàn thành"}),t.jsxs("button",{onClick:b,className:"w-full px-4 py-2 text-sm bg-red-500 text-white rounded-md hover:bg-red-600 transition flex items-center justify-center",children:[t.jsx(Ee,{size:16,className:"mr-2"})," Xoá khỏi danh sách"]}),t.jsx("button",{onClick:u,className:"w-full mt-1 py-1 text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:"Để sau"})]})]})}):null,Pe=({setIsPageInFocusMode:f})=>{const[s,y]=o.useState(()=>{const e=localStorage.getItem("timerSettings_v2");try{if(e){const r=JSON.parse(e);return{...L,...r,selectedNotificationSound:r.selectedNotificationSound&&F.some(a=>a.url===r.selectedNotificationSound)?r.selectedNotificationSound:L.selectedNotificationSound,currentMusicTrackIndex:typeof r.currentMusicTrackIndex=="number"&&r.currentMusicTrackIndex>=0&&r.currentMusicTrackIndex<K.length?r.currentMusicTrackIndex:L.currentMusicTrackIndex,alarmSoundRepeat:typeof r.alarmSoundRepeat=="number"?Math.max(1,Math.min(5,r.alarmSoundRepeat)):L.alarmSoundRepeat}}}catch(r){console.error("Lỗi parse settings từ localStorage:",r)}return L}),[b,u]=o.useState(s.workDuration*60),[l,h]=o.useState(!1),[c,B]=o.useState("work"),[C,n]=o.useState(0),[p,g]=o.useState(!1),[D,P]=o.useState(!1),[N,T]=o.useState(()=>{const e=localStorage.getItem("timerTasks_v2");if(e)try{const r=JSON.parse(e);if(Array.isArray(r))return r.map(a=>{let x="in_progress";return a.status==="in_progress"||a.status==="completed"?x=a.status:a.status==="hidden"&&(x="completed"),{id:String(a.id||Date.now()+Math.random()),name:String(a.name||"Công việc không tên"),status:x,cyclesCompleted:typeof a.cyclesCompleted=="number"?a.cyclesCompleted:0,estimatedCycles:typeof a.estimatedCycles=="number"&&a.estimatedCycles>0?a.estimatedCycles:1}}).filter(a=>a!==null&&typeof a.id=="string"&&typeof a.name=="string"&&(a.status==="in_progress"||a.status==="completed")&&typeof a.cyclesCompleted=="number"&&typeof a.estimatedCycles=="number")}catch(r){return console.error("Lỗi khi parse tasks từ localStorage:",r),[]}return[]}),[U,X]=o.useState(""),[H,W]=o.useState(1),[d,$]=o.useState(()=>{const e=localStorage.getItem("timerActiveTaskId");if(e&&e!=="undefined"&&e!=="null")try{const r=JSON.parse(e);return typeof r=="string"?r:null}catch(r){return console.error("Lỗi parse activeTaskId:",r),null}return null});o.useEffect(()=>{d&&(N.some(r=>r.id===d&&r.status==="in_progress")||$(null))},[N,d]);const[m,ae]=o.useState(!1),[ne,V]=o.useState(!1),[k,E]=o.useState(null),[q,oe]=o.useState(!0),v=o.useRef(null),w=o.useRef(null),A=o.useRef(),M=o.useRef(0),Q=o.useRef(!1);o.useEffect(()=>{localStorage.setItem("timerSettings_v2",JSON.stringify(s))},[s]),o.useEffect(()=>{if(!l){let e;c==="work"?e=s.workDuration*60:c==="short_break"?e=s.shortBreakDuration*60:e=s.longBreakDuration*60,u(e)}},[c,s.workDuration,s.shortBreakDuration,s.longBreakDuration,s.cyclesBeforeLongBreak]),o.useEffect(()=>{localStorage.setItem("timerTasks_v2",JSON.stringify(N))},[N]),o.useEffect(()=>{d===null?localStorage.removeItem("timerActiveTaskId"):localStorage.setItem("timerActiveTaskId",JSON.stringify(d))},[d]),o.useEffect(()=>{const e=l&&s.darkModeOnStart&&c==="work";e!==m&&(ae(e),f(e),e||V(!1))},[l,s.darkModeOnStart,c,f,m]),o.useEffect(()=>{if(w.current&&s.selectedNotificationSound){const e=new URL(s.selectedNotificationSound,window.location.origin).href;w.current.src!==e&&(w.current.src=e)}},[s.selectedNotificationSound]);const Y=o.useCallback(()=>{if(console.log("[Notification] playNotificationSound called. Repeat count:",s.alarmSoundRepeat),!w.current||s.alarmSoundRepeat<=0){console.log("[Notification] Sound disabled or ref not available.");return}const e=w.current,r=new URL(s.selectedNotificationSound,window.location.origin).href;console.log(`[Notification] Target src: ${r}, Current src: ${e.src}`),e.src!==r&&(console.log(`[Notification] Updating src to ${r}`),e.src=r),M.current=0;const i=()=>{console.log(`[Notification] Attempting play. Count: ${M.current}, Target: ${s.alarmSoundRepeat}`),M.current<s.alarmSoundRepeat?(e.currentTime=0,console.log("[Notification] Calling audio.play()"),e.play().then(()=>{console.log(`[Notification] Play #${M.current+1} started for ${e.src}.`)}).catch(x=>{console.error("[Notification] Lỗi phát âm báo:",x.name,x.message),e.removeEventListener("ended",a)})):(console.log("[Notification] Repeat sequence finished."),e.removeEventListener("ended",a))},a=()=>{M.current++,console.log(`[Notification] Sound ended. Count is now: ${M.current}`),i()};e.removeEventListener("ended",a),e.addEventListener("ended",a),console.log("[Notification] Starting first play of sequence."),i()},[s.selectedNotificationSound,s.alarmSoundRepeat]),Z=o.useCallback(()=>{Y(),v.current&&!v.current.paused&&v.current.pause();let e,r=C;c==="work"?(d&&T(i=>i.map(a=>a.id===d?{...a,cyclesCompleted:a.cyclesCompleted+1}:a)),r=C+1,r>=s.cyclesBeforeLongBreak?(e="long_break",n(0)):(e="short_break",n(r)),typeof Notification<"u"&&Notification.permission==="granted"?new Notification("Đến giờ giải lao rồi!",{body:`Hãy đứng dậy, di chuyển hoặc thư giãn một chút nhé. ${e==="short_break"?"Nghỉ ngắn":"Nghỉ dài"} sắp bắt đầu.`,icon:"/marcusfi-website/favicon.ico"}):typeof Notification<"u"&&Notification.permission!=="denied"&&Notification.requestPermission().then(i=>{i==="granted"&&new Notification("Đến giờ giải lao rồi!",{body:`Hãy đứng dậy, di chuyển hoặc thư giãn một chút nhé. ${e==="short_break"?"Nghỉ ngắn":"Nghỉ dài"} sắp bắt đầu.`,icon:"/marcusfi-website/favicon.ico"})})):e="work",h(!1),B(e)},[d,C,s,Y,c,T]);o.useEffect(()=>(l&&b>0?A.current=window.setInterval(()=>{u(e=>e<=1?(clearInterval(A.current),Z(),0):e-1)},1e3):(!l||b===0)&&clearInterval(A.current),()=>{clearInterval(A.current)}),[l,b,Z]),o.useEffect(()=>{const e=v.current;if(!e)return;const r=()=>{const i=(s.currentMusicTrackIndex+1)%K.length;y(a=>({...a,currentMusicTrackIndex:i}))};if(e.removeEventListener("ended",r),e.addEventListener("ended",r),s.includeMusic&&c==="work"){const i=K[s.currentMusicTrackIndex];if(!i){e.paused||e.pause();return}const a=i.src,x=new URL(a,window.location.origin).href;e.src!==x&&(e.src=a,e.load()),l&&e.paused?e.play().catch(R=>console.error("Lỗi phát nhạc nền:",R.name,R.message)):!l&&!e.paused&&e.pause()}else e.paused||e.pause();return()=>{e.removeEventListener("ended",r)}},[l,c,s,y]);const ie=()=>{if(c==="work"&&!d){alert("Vui lòng chọn một công việc để bắt đầu phiên làm việc.");return}if(b===0){let e;c==="work"?e=s.workDuration*60:c==="short_break"?e=s.shortBreakDuration*60:e=s.longBreakDuration*60,u(e)}if(!Q.current){if(console.log("Attempting to unlock audio context on first user interaction..."),w.current){const e=w.current;if(!e.src&&F.length>0&&(e.src=new URL(s.selectedNotificationSound,window.location.origin).href),e.src){const r=e.muted;e.muted=!0,e.play().then(()=>{e.pause(),e.currentTime=0,e.muted=r,console.log("Notification audio context likely unlocked.")}).catch(i=>{console.warn("Could not unlock notification audio:",i.name,i.message),e.muted=r})}}Q.current=!0}h(!0)},ce=()=>{h(!1)},le=()=>{h(!1);let e;c==="work"?e=s.workDuration*60:c==="short_break"?e=s.shortBreakDuration*60:e=s.longBreakDuration*60,u(e)},de=()=>{c!=="work"&&(h(!1),B("work"))},ue=()=>{if(U.trim()){const e={id:String(Date.now()+Math.random()),name:U.trim(),status:"in_progress",cyclesCompleted:0,estimatedCycles:H>0?H:1};T(r=>[...r,e].sort(I)),X(""),W(1),P(!1)}},I=(e,r)=>{const i={in_progress:1,completed:2};return i[e.status]!==i[r.status]?i[e.status]-i[r.status]:0},ee=e=>{const r=N.find(i=>i.id===e);r&&(r.status==="in_progress"?E(r):r.status==="completed"&&T(i=>i.map(a=>a.id===e?{...a,status:"in_progress"}:a).sort(I)))},me=()=>{k&&(T(e=>e.map(r=>r.id===k.id?{...r,status:"completed"}:r).sort(I)),d===k.id&&$(null),E(null))},ge=()=>{k&&(T(e=>e.filter(r=>r.id!==k.id)),d===k.id&&$(null),E(null))},pe=e=>{const r=Math.floor(e/60),i=e%60;return`${r.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},te=e=>{if(!e||e.status==="completed")return"Hoàn thành";const r=e.cyclesCompleted,i=e.estimatedCycles-r;if(i<=0)return"Sắp xong!";let a=0,x=C;for(let G=0;G<i;G++)a+=s.workDuration,G<i-1&&(x++,x>=s.cyclesBeforeLongBreak?(a+=s.longBreakDuration,x=0):a+=s.shortBreakDuration);const R=new Date(Date.now()+a*60*1e3),xe={day:"2-digit",month:"2-digit",year:"numeric"};return R.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})+", "+R.toLocaleDateString("vi-VN",xe)},_=d?N.find(e=>e.id===d):null,J=N.filter(e=>e.status==="in_progress").sort(I),z=N.filter(e=>e.status==="completed").sort(I);return t.jsxs("div",{className:`max-w-xl mx-auto p-4 sm:p-6 rounded-2xl shadow-xl transition-all duration-300 ease-in-out relative
             ${m?"bg-black min-h-[380px] sm:min-h-[420px] flex flex-col justify-center items-center":"bg-gray-50 dark:bg-gray-800"}`,onMouseEnter:()=>{m&&V(!0)},onMouseLeave:()=>{m&&V(!1)},children:[t.jsx(O,{children:!m&&t.jsx(j.div,{initial:{opacity:1},exit:{opacity:0},className:"mb-4 text-center",children:t.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center text-sm text-gray-500 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors py-1.5 px-2.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent hover:border-gray-200 dark:hover:border-gray-600",children:[t.jsx(he,{size:15,className:"mr-1.5"}),"Cài đặt Timer"]})})}),t.jsxs("div",{className:`text-center transition-opacity duration-300 ${p?"opacity-10 pointer-events-none":"opacity-100"}`,children:[t.jsx(O,{mode:"wait",children:t.jsx(j.h2,{initial:{opacity:0,y:m?0:-10},animate:{opacity:m?0:1,y:0},exit:{opacity:0,y:m?0:10},transition:{duration:.25},className:`text-3xl sm:text-4xl font-bold mb-2
                            ${m?"h-0 overflow-hidden pointer-events-none":c==="work"?"text-gray-800 dark:text-gray-100":c==="short_break"?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"}`,children:c==="work"?"Thời Gian Tập Trung":c==="short_break"?"Nghỉ Ngắn":"Nghỉ Dài"},c)}),t.jsx("div",{className:`text-6xl font-mono font-bold mb-4 ${m?"text-white":"text-purple-600 dark:text-purple-400"}`,children:pe(b)}),t.jsxs("div",{className:`flex justify-center space-x-3 sm:space-x-4 mb-6 transition-opacity duration-300
                     ${m&&!ne?"opacity-0 pointer-events-none":"opacity-100"}`,children:[t.jsx("button",{onClick:l?ce:ie,disabled:!l&&c==="work"&&!d,className:`p-3 rounded-full text-white transition-all duration-200 ease-in-out transform hover:scale-105
                       ${l?"bg-red-500 hover:bg-red-600 shadow-md":"bg-purple-600 hover:bg-purple-700 shadow-md"}
                       ${!l&&c==="work"&&!d?"opacity-50 cursor-not-allowed":""}
                       ${m?l?"bg-red-500/70 hover:bg-red-600/90":"bg-purple-600/70 hover:bg-purple-500/90":""}
                      `,title:!l&&c==="work"&&!d?"Vui lòng chọn công việc":l?"Tạm dừng":"Bắt đầu",children:l?t.jsx(fe,{size:24}):t.jsx(ye,{size:24})}),t.jsx("button",{onClick:le,className:`p-3 rounded-full transition-colors transform hover:scale-105 shadow-sm
                       ${m?"bg-gray-600/60 hover:bg-gray-500/80 text-gray-200":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"}
                      `,children:t.jsx(De,{size:24})}),c!=="work"&&!l&&t.jsx("button",{onClick:de,className:`p-3 rounded-full text-white transition-colors transform hover:scale-105 shadow-sm
                         ${m?"bg-amber-600/60 hover:bg-amber-500/80":"bg-amber-500 hover:bg-amber-600"}
                        `,children:t.jsx(Be,{size:24})})]})]}),m&&_&&t.jsxs("div",{className:"mt-4 sm:mt-6 text-center absolute bottom-6 left-1/2 -translate-x-1/2 w-full px-4",children:[t.jsx("p",{className:"text-lg sm:text-xl text-white font-semibold truncate",title:_.name,children:_.name}),t.jsxs("p",{className:"text-xs sm:text-sm text-gray-400 mt-2",children:[_.cyclesCompleted," / ",_.estimatedCycles," sessions - Dự kiến: ",te(_)]})]}),t.jsxs("div",{className:`border-t border-gray-200 dark:border-gray-700 pt-6 mt-4 transition-opacity duration-300 ${m||p?"opacity-10 pointer-events-none h-0 overflow-hidden":"opacity-100"}`,children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Công việc của bạn"}),!D&&t.jsx("button",{onClick:()=>P(!0),className:"p-1.5 text-purple-600 dark:text-purple-400 hover:bg-purple-100 dark:hover:bg-gray-700 rounded-full transition-colors",title:"Thêm công việc mới",children:t.jsx(Me,{size:20})})]}),t.jsx(O,{children:D&&t.jsxs(j.form,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},onSubmit:e=>{e.preventDefault(),ue()},className:"flex flex-col sm:flex-row gap-2 mb-4 items-end p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 shadow-sm",children:[t.jsxs("div",{className:"flex-1 w-full sm:w-auto",children:[t.jsx("label",{htmlFor:"newTaskName",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-0.5",children:"Tên công việc"}),t.jsx("input",{type:"text",id:"newTaskName",value:U,onChange:e=>X(e.target.value),placeholder:"Thêm công việc mới...",className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-purple-500 dark:focus:border-purple-400 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100"})]}),t.jsxs("div",{className:"w-full sm:w-20",children:[t.jsx("label",{htmlFor:"newTaskCycles",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-0.5",children:"Cycles"}),t.jsx("input",{type:"number",id:"newTaskCycles",min:"1",value:H,onChange:e=>W(Number(e.target.value)),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-purple-500 dark:focus:border-purple-400 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100"})]}),t.jsxs("div",{className:"flex gap-2 w-full sm:w-auto mt-2 sm:mt-0",children:[t.jsxs("button",{type:"submit",className:"flex-1 sm:flex-none px-3 py-1.5 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors self-end h-[34px] text-sm flex items-center justify-center gap-1",children:[t.jsx(Re,{size:16})," Lưu"]}),t.jsxs("button",{type:"button",onClick:()=>P(!1),className:"flex-1 sm:flex-none px-3 py-1.5 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors self-end h-[34px] text-sm flex items-center justify-center gap-1",children:[t.jsx(Ce,{size:16})," Hủy"]})]})]})}),J.length>0&&t.jsx("div",{className:"text-sm mb-2 text-gray-500 dark:text-gray-400 font-medium",children:"Đang thực hiện:"}),t.jsxs("div",{className:"space-y-2",children:[J.length===0&&z.length===0&&!D&&t.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-3 italic",children:"Chưa có công việc nào. Nhấn + để thêm."}),J.map(e=>t.jsxs("div",{className:`p-3 rounded-lg border transition-all duration-200 
                ${d===e.id?"bg-purple-50 dark:bg-purple-900/30 border-purple-500 dark:border-purple-600 shadow-lg ring-1 ring-purple-500 dark:ring-purple-600":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2.5 flex-1 min-w-0",children:[t.jsx("button",{onClick:()=>ee(e.id),className:"p-1.5 rounded-full transition-colors flex-shrink-0 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-500 dark:text-gray-400",children:t.jsx(se,{size:14})}),t.jsx("span",{className:"text-sm truncate text-gray-800 dark:text-gray-100",title:e.name,children:e.name})]}),t.jsx("button",{onClick:()=>{e.status==="in_progress"&&$(d===e.id?null:e.id)},disabled:e.status!=="in_progress",className:`px-2.5 py-1 rounded-full text-xs font-medium transition-all whitespace-nowrap ${d===e.id?"bg-purple-600 text-white shadow-sm":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-purple-100 dark:hover:bg-purple-800/50 hover:text-purple-700 dark:hover:text-purple-300"}`,children:d===e.id?"Đang làm":"Chọn làm"})]}),t.jsxs("div",{className:"mt-2.5 flex flex-col sm:flex-row items-start sm:items-center justify-between text-xs text-gray-500 dark:text-gray-400 pl-9 space-y-1 sm:space-y-0",children:[t.jsxs("span",{className:"flex items-center",title:"Số chu kỳ đã hoàn thành / Số chu kỳ dự kiến",children:[t.jsx(re,{size:14,className:"mr-1 text-blue-500 dark:text-blue-400 flex-shrink-0"}),e.cyclesCompleted," / ",e.estimatedCycles," cycles"]}),e.status==="in_progress"&&e.estimatedCycles>e.cyclesCompleted&&t.jsxs("span",{className:"flex items-center",title:"Thời gian dự kiến hoàn thành",children:[t.jsx(be,{size:14,className:"mr-1 text-orange-500 dark:text-orange-400 flex-shrink-0"}),"Dự kiến: ",te(e)]})]})]},e.id))]}),z.length>0&&t.jsxs("div",{className:"mt-5 pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("button",{onClick:()=>oe(!q),className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-purple-600 dark:hover:text-purple-400 flex items-center w-full justify-between py-1",children:[t.jsxs("span",{children:["Công việc đã hoàn thành (",z.length,")"]}),t.jsx(ke,{size:18,className:`transition-transform ${q?"rotate-180":""}`})]}),t.jsx(O,{children:q&&t.jsx(j.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mt-2 space-y-2",children:z.map(e=>t.jsxs("div",{className:"p-3 rounded-lg border opacity-70 bg-gray-100 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2.5 flex-1 min-w-0",children:[t.jsx("button",{onClick:()=>ee(e.id),className:"p-1.5 rounded-full transition-colors flex-shrink-0 bg-green-500 hover:bg-green-600 text-white",children:t.jsx(se,{size:14})}),t.jsx("span",{className:"text-sm truncate line-through text-gray-500 dark:text-gray-400",title:e.name,children:e.name})]}),t.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 cursor-default whitespace-nowrap",children:"Đã xong"})]}),t.jsxs("div",{className:"mt-2 flex items-center text-xs text-gray-400 dark:text-gray-500 pl-9",children:[t.jsx(re,{size:14,className:"mr-1 text-blue-400 dark:text-blue-500 flex-shrink-0"}),"Hoàn thành ",e.cyclesCompleted," / ",e.estimatedCycles," cycles"]})]},e.id))})})]})]}),t.jsx("audio",{ref:v}),t.jsx("audio",{ref:w}),t.jsx(Oe,{isOpen:p,onClose:()=>g(!1),currentSettings:s,onSaveSettings:e=>{const r=s;y(e),v.current&&r.includeMusic&&!e.includeMusic&&!v.current.paused&&v.current.pause()}}),k&&t.jsx(Fe,{isOpen:!!k,taskName:k.name,onMarkAsCompleted:me,onDeletePermanently:ge,onCancel:()=>E(null)})]})},qe=()=>{const[f,s]=o.useState(!1);return t.jsx("div",{className:`min-h-screen py-12 sm:py-16 md:py-20 transition-colors duration-300 ease-in-out
                  ${f?"bg-black":"bg-gradient-to-br from-purple-50 via-white to-blue-50"}`,children:t.jsxs("div",{className:"container mx-auto px-4",children:[t.jsx("div",{className:`text-center mb-8 sm:mb-10 transition-opacity duration-300 ${f?"opacity-0 h-0 overflow-hidden pointer-events-none":"opacity-100"}`,children:t.jsxs("div",{className:"relative max-w-xl mx-auto",children:[t.jsxs(ve,{to:"/",className:"absolute left-0 top-1/2 -translate-y-1/2 flex items-center text-xs sm:text-sm text-purple-600 hover:text-purple-800 transition-colors group py-2 pr-2",children:[t.jsx(we,{size:16,className:"mr-1 transition-transform group-hover:-translate-x-0.5"}),"Trang chủ"]}),t.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-800",children:"Timer Block"})]})}),t.jsx(Pe,{setIsPageInFocusMode:s})]})})};export{qe as default};
