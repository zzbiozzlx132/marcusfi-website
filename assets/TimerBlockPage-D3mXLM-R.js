import{c as C,r as i,j as t,B as P,m as S,S as ye,R as be,T as ke,K as ne,C as we,X as Ne,L as ve}from"./index-BSox20yL.js";import{L as se}from"./list-checks-2bqClsyI.js";import{A as je}from"./arrow-left-CRVFthVl.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ae=C("check",Se);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],Te=C("circle-x",Ce);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],De=C("plus",Me);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Ie=C("rotate-ccw",_e);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],Le=C("save",Be);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]],Ee=C("skip-forward",Re);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],ze=C("trash-2",$e);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],Fe=C("volume-2",Ae),X=[{name:"Thông báo 1",url:"/marcusfi-website/sound/ntf-snd-01.mp3"},{name:"Thông báo 2",url:"/marcusfi-website/sound/ntf-snd-02.mp3"},{name:"Thông báo 3",url:"/marcusfi-website/sound/ntf-snd-03.mp3"},{name:"Thông báo 4",url:"/marcusfi-website/sound/ntf-snd-04.mp3"},{name:"Thông báo 5",url:"/marcusfi-website/sound/ntf-snd-05.mp3"},{name:"Thông báo 6",url:"/marcusfi-website/sound/ntf-snd-06.mp3"}],I=[{id:"local_track1",title:"Nhạc Nền 1",src:"/marcusfi-website/music1.mp3"},{id:"local_track2",title:"Nhạc Nền 2",src:"/marcusfi-website/music2.mp3"},{id:"local_track3",title:"Nhạc Nền 3",src:"/marcusfi-website/music3.mp3"},{id:"local_track4",title:"Nhạc Nền 4",src:"/marcusfi-website/music4.mp3"},{id:"local_track5",title:"Nhạc Nền 5",src:"/marcusfi-website/music5.mp3"},{id:"local_track6",title:"Nhạc Nền 6",src:"/marcusfi-website/music6.mp3"},{id:"local_track7",title:"Nhạc Nền 7",src:"/marcusfi-website/music7.mp3"},{id:"local_track8",title:"Nhạc Nền 8",src:"/marcusfi-website/music8.mp3"},{id:"local_track9",title:"Nhạc Nền 9",src:"/marcusfi-website/music9.mp3"},{id:"local_track10",title:"Nhạc Nền 10",src:"/marcusfi-website/music10.mp3"}],L={workDuration:25,shortBreakDuration:5,longBreakDuration:15,cyclesBeforeLongBreak:4,includeMusic:!1,alarmSoundRepeat:1,darkModeOnStart:!0,selectedNotificationSound:X[0].url,currentMusicTrackIndex:0},Oe=({isOpen:k,onClose:s,currentSettings:w,onSaveSettings:f})=>{const[m,l]=i.useState(w),y=i.useRef(null);i.useEffect(()=>{l(w)},[w]);const o=(n,h)=>{let x=h;if(typeof h=="string"&&(n==="workDuration"||n==="shortBreakDuration"||n==="longBreakDuration"||n==="cyclesBeforeLongBreak"||n==="alarmSoundRepeat")){let b=parseInt(h,10);(isNaN(b)||b<1)&&(b=1),x=b}n==="alarmSoundRepeat"&&typeof x=="number"?x=Math.max(1,Math.min(5,x)):(n==="workDuration"||n==="shortBreakDuration"||n==="longBreakDuration"||n==="cyclesBeforeLongBreak")&&typeof x=="number"&&(x=Math.max(1,x)),l(b=>({...b,[n]:x}))},R=()=>{f(m),s()},T=()=>{y.current||(y.current=new Audio);const n=new URL(m.selectedNotificationSound,window.location.origin).href;y.current.src=n,y.current.play().catch(h=>console.error("Lỗi nghe thử âm báo:",h.name,h.message))};if(!k)return null;const E=[{label:"Pomodoro",field:"workDuration"},{label:"Short Break",field:"shortBreakDuration"},{label:"Long Break",field:"longBreakDuration"}];return t.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4",onClick:s,children:t.jsxs(S.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 p-5 sm:p-6 rounded-xl shadow-2xl w-full max-w-md",onClick:n=>n.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:"Cài đặt Timer"}),t.jsx("button",{onClick:s,className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:t.jsx(Ne,{size:20})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center text-gray-500 dark:text-gray-400 mb-1",children:[t.jsx(ne,{size:16,className:"mr-1.5"}),t.jsx("span",{className:"text-xs font-semibold uppercase tracking-wider",children:"TIMER"})]}),t.jsx("label",{className:"block text-sm font-semibold text-gray-800 dark:text-gray-100 mb-1.5",children:"Time (minutes)"}),t.jsx("div",{className:"grid grid-cols-3 gap-x-3",children:E.map(n=>t.jsxs("div",{children:[t.jsx("label",{htmlFor:n.field,className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:n.label}),t.jsx("input",{type:"number",id:n.field,min:"1",value:m[n.field],onChange:h=>o(n.field,h.target.value),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-center"})]},n.field))})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notificationSound",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:"Âm thanh thông báo"}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("select",{id:"notificationSound",value:m.selectedNotificationSound,onChange:n=>o("selectedNotificationSound",n.target.value),className:"flex-grow px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100",children:X.map(n=>t.jsx("option",{value:n.url,children:n.name},n.url))}),t.jsx("button",{onClick:T,title:"Nghe thử",className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300 transition-colors",children:t.jsx(Fe,{size:18})})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-x-3",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"cyclesBeforeLongBreak",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:"Chu kỳ / Nghỉ dài"}),t.jsx("input",{type:"number",id:"cyclesBeforeLongBreak",min:"1",value:m.cyclesBeforeLongBreak,onChange:n=>o("cyclesBeforeLongBreak",n.target.value),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-center"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"alarmRepeat",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-1",children:"Số lần lặp âm báo (1-5)"}),t.jsx("input",{type:"number",id:"alarmRepeat",min:"1",max:"5",value:m.alarmSoundRepeat,onChange:n=>o("alarmSoundRepeat",n.target.value),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 focus:border-purple-500 text-sm bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 text-center"})]})]}),t.jsxs("div",{className:"flex items-center justify-between pt-2 space-x-4",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"modalIncludeMusic",checked:m.includeMusic,onChange:n=>o("includeMusic",n.target.checked),className:"h-4 w-4 text-purple-600 focus:ring-offset-0 focus:ring-1 focus:ring-purple-500 border-gray-300 dark:border-gray-600 rounded"}),t.jsx("label",{htmlFor:"modalIncludeMusic",className:"ml-2 block text-sm text-gray-700 dark:text-gray-200",children:"Nhạc nền (Work mode)"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",id:"modalDarkModeOnStart",checked:m.darkModeOnStart,onChange:n=>o("darkModeOnStart",n.target.checked),className:"h-4 w-4 text-purple-600 focus:ring-offset-0 focus:ring-1 focus:ring-purple-500 border-gray-300 dark:border-gray-600 rounded"}),t.jsx("label",{htmlFor:"modalDarkModeOnStart",className:"ml-2 block text-sm text-gray-700 dark:text-gray-200",children:"Dark Mode khi Start (Work)"})]})]})]}),t.jsx("button",{onClick:R,className:"w-full mt-6 py-2.5 px-4 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500",children:"Lưu Cài Đặt"})]})})},Pe=({isOpen:k,taskName:s,onMarkAsCompleted:w,onDeletePermanently:f,onCancel:m})=>k?t.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-center justify-center p-4",onClick:m,children:t.jsxs(S.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 p-5 sm:p-6 rounded-lg shadow-xl w-full max-w-xs text-center",onClick:l=>l.stopPropagation(),children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Hoàn Thành Công Việc!"}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-5",children:["Tuyệt vời! Bạn đã hoàn thành: ",t.jsxs("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:['"',s,'"']}),".",t.jsx("br",{}),"Chọn hành động tiếp theo:"]}),t.jsxs("div",{className:"space-y-2.5",children:[t.jsx("button",{onClick:w,className:"w-full px-4 py-2 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600 transition",children:"Đánh dấu Hoàn thành"}),t.jsxs("button",{onClick:f,className:"w-full px-4 py-2 text-sm bg-red-500 text-white rounded-md hover:bg-red-600 transition flex items-center justify-center",children:[t.jsx(ze,{size:16,className:"mr-2"})," Xoá khỏi danh sách"]}),t.jsx("button",{onClick:m,className:"w-full mt-1 py-1 text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:"Để sau"})]})]})}):null,Ue=({setIsPageInFocusMode:k})=>{const[s,w]=i.useState(()=>{const e=localStorage.getItem("timerSettings_v2");try{if(e){const r=JSON.parse(e);return{...L,...r,selectedNotificationSound:r.selectedNotificationSound&&X.some(a=>a.url===r.selectedNotificationSound)?r.selectedNotificationSound:L.selectedNotificationSound,currentMusicTrackIndex:typeof r.currentMusicTrackIndex=="number"&&r.currentMusicTrackIndex>=0&&r.currentMusicTrackIndex<I.length?r.currentMusicTrackIndex:L.currentMusicTrackIndex,alarmSoundRepeat:typeof r.alarmSoundRepeat=="number"?Math.max(1,Math.min(5,r.alarmSoundRepeat)):L.alarmSoundRepeat}}}catch(r){console.error("Lỗi parse settings từ localStorage:",r)}return L}),[f,m]=i.useState(s.workDuration*60),[l,y]=i.useState(!1),[o,R]=i.useState("work"),[T,E]=i.useState(0),[n,h]=i.useState(!1),[x,b]=i.useState(!1),[v,M]=i.useState(()=>{const e=localStorage.getItem("timerTasks_v2");if(e)try{const r=JSON.parse(e);if(Array.isArray(r))return r.map(a=>{let g="in_progress";return a.status==="in_progress"||a.status==="completed"?g=a.status:a.status==="hidden"&&(g="completed"),{id:String(a.id||Date.now()+Math.random()),name:String(a.name||"Công việc không tên"),status:g,cyclesCompleted:typeof a.cyclesCompleted=="number"?a.cyclesCompleted:0,estimatedCycles:typeof a.estimatedCycles=="number"&&a.estimatedCycles>0?a.estimatedCycles:1}}).filter(a=>a!==null&&typeof a.id=="string"&&typeof a.name=="string"&&(a.status==="in_progress"||a.status==="completed")&&typeof a.cyclesCompleted=="number"&&typeof a.estimatedCycles=="number")}catch(r){return console.error("Lỗi khi parse tasks từ localStorage:",r),[]}return[]}),[U,W]=i.useState(""),[H,Q]=i.useState(1),[d,$]=i.useState(()=>{const e=localStorage.getItem("timerActiveTaskId");if(e&&e!=="undefined"&&e!=="null")try{const r=JSON.parse(e);return typeof r=="string"?r:null}catch(r){return console.error("Lỗi parse activeTaskId:",r),null}return null});i.useEffect(()=>{d&&(v.some(r=>r.id===d&&r.status==="in_progress")||$(null))},[v,d]);const[u,ie]=i.useState(!1),[oe,V]=i.useState(!1),[N,z]=i.useState(null),[q,ce]=i.useState(!0),p=i.useRef(null),j=i.useRef(null),A=i.useRef(),J=i.useRef(0),G=i.useRef(!1);i.useEffect(()=>{localStorage.setItem("timerSettings_v2",JSON.stringify(s))},[s]),i.useEffect(()=>{if(!l){let e;o==="work"?e=s.workDuration*60:o==="short_break"?e=s.shortBreakDuration*60:e=s.longBreakDuration*60,m(e)}},[o,s.workDuration,s.shortBreakDuration,s.longBreakDuration,s.cyclesBeforeLongBreak,l]),i.useEffect(()=>{localStorage.setItem("timerTasks_v2",JSON.stringify(v))},[v]),i.useEffect(()=>{d===null?localStorage.removeItem("timerActiveTaskId"):localStorage.setItem("timerActiveTaskId",JSON.stringify(d))},[d]),i.useEffect(()=>{const e=l&&s.darkModeOnStart&&o==="work";e!==u&&(ie(e),k(e),e||V(!1))},[l,s.darkModeOnStart,o,k,u]),i.useEffect(()=>{if(j.current&&s.selectedNotificationSound){const e=new URL(s.selectedNotificationSound,window.location.origin).href;j.current.src!==e&&(j.current.src=e)}},[s.selectedNotificationSound]);const Y=i.useCallback(()=>{if(!j.current||s.alarmSoundRepeat<=0)return;const e=j.current,r=new URL(s.selectedNotificationSound,window.location.origin).href;e.src!==r&&(e.src=r),J.current=0;const c=()=>{J.current<s.alarmSoundRepeat?(e.currentTime=0,e.play().catch(g=>{console.error("[Notification] Lỗi phát âm báo:",g.name,g.message),e.removeEventListener("ended",a)})):e.removeEventListener("ended",a)},a=()=>{J.current++,c()};e.removeEventListener("ended",a),e.addEventListener("ended",a),c()},[s.selectedNotificationSound,s.alarmSoundRepeat]),Z=i.useCallback(()=>{Y(),p.current&&!p.current.paused&&p.current.pause();let e,r=T;o==="work"?(d&&M(c=>c.map(a=>a.id===d?{...a,cyclesCompleted:a.cyclesCompleted+1}:a)),r=T+1,r>=s.cyclesBeforeLongBreak?(e="long_break",E(0)):(e="short_break",E(r)),typeof Notification<"u"&&Notification.permission==="granted"?new Notification("Đến giờ giải lao rồi!",{body:`Hãy đứng dậy, di chuyển hoặc thư giãn một chút nhé. ${e==="short_break"?"Nghỉ ngắn":"Nghỉ dài"} sắp bắt đầu.`,icon:"/marcusfi-website/favicon.ico"}):typeof Notification<"u"&&Notification.permission!=="denied"&&Notification.requestPermission().then(c=>{c==="granted"&&new Notification("Đến giờ giải lao rồi!",{body:`Hãy đứng dậy, di chuyển hoặc thư giãn một chút nhé. ${e==="short_break"?"Nghỉ ngắn":"Nghỉ dài"} sắp bắt đầu.`,icon:"/marcusfi-website/favicon.ico"})})):e="work",y(!1),R(e)},[d,T,s,Y,o,M]);i.useEffect(()=>(l&&f>0?A.current=window.setInterval(()=>{m(e=>e<=1?(clearInterval(A.current),Z(),0):e-1)},1e3):(!l||f===0)&&clearInterval(A.current),()=>{clearInterval(A.current)}),[l,f,Z]),i.useEffect(()=>{const e=p.current;if(!e)return;const r=()=>{const c=(s.currentMusicTrackIndex+1)%I.length;w(a=>({...a,currentMusicTrackIndex:c}))};if(e.removeEventListener("ended",r),e.addEventListener("ended",r),s.includeMusic&&o==="work"){const c=I[s.currentMusicTrackIndex];if(!c){e.paused||e.pause();return}const a=new URL(c.src,window.location.origin).href;e.src!==a&&(e.src=a,e.load()),l&&e.paused?e.play().catch(g=>console.error("Lỗi phát nhạc nền:",g.name,g.message)):!l&&!e.paused&&e.pause()}else e.paused||e.pause();return()=>{e.removeEventListener("ended",r)}},[l,o,s.includeMusic,s.currentMusicTrackIndex,w]);const le=()=>{if(o==="work"&&!d){alert("Vui lòng chọn một công việc để bắt đầu phiên làm việc.");return}if(f===0){let e;o==="work"?e=s.workDuration*60:o==="short_break"?e=s.shortBreakDuration*60:e=s.longBreakDuration*60,m(e)}if(!G.current){if(j.current){const e=j.current;if(!e.src&&s.selectedNotificationSound&&(e.src=new URL(s.selectedNotificationSound,window.location.origin).href),e.src){const r=e.muted;e.muted=!0,e.play().then(()=>{e.pause(),e.currentTime=0,e.muted=r}).catch(()=>{e.muted=r})}}if(p.current&&s.includeMusic){const e=p.current;if(!e.src&&I[s.currentMusicTrackIndex]&&(e.src=new URL(I[s.currentMusicTrackIndex].src,window.location.origin).href),e.src){const r=e.muted;e.muted=!0,e.play().then(()=>{e.pause(),e.currentTime=0,e.muted=r}).catch(()=>{e.muted=r})}}G.current=!0}y(!0)},de=()=>{y(!1)},ue=()=>{y(!1);let e;o==="work"?e=s.workDuration*60:o==="short_break"?e=s.shortBreakDuration*60:e=s.longBreakDuration*60,m(e)},me=()=>{o!=="work"&&(y(!1),R("work"))},ge=()=>{if(U.trim()){const e={id:String(Date.now()+Math.random()),name:U.trim(),status:"in_progress",cyclesCompleted:0,estimatedCycles:H>0?H:1};M(r=>[...r,e].sort(B)),W(""),Q(1),b(!1)}},B=(e,r)=>{const c={in_progress:1,completed:2};return c[e.status]!==c[r.status]?c[e.status]-c[r.status]:0},ee=e=>{const r=v.find(c=>c.id===e);r&&(r.status==="in_progress"?z(r):r.status==="completed"&&M(c=>c.map(a=>a.id===e?{...a,status:"in_progress"}:a).sort(B)))},xe=()=>{N&&(M(e=>e.map(r=>r.id===N.id?{...r,status:"completed"}:r).sort(B)),d===N.id&&$(null),z(null))},pe=()=>{N&&(M(e=>e.filter(r=>r.id!==N.id)),d===N.id&&$(null),z(null))},he=e=>{const r=Math.floor(e/60),c=e%60;return`${r.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`},te=e=>{if(!e||e.status==="completed")return"Hoàn thành";const r=e.cyclesCompleted,c=e.estimatedCycles-r;if(c<=0)return"Sắp xong!";let a=0,g=T,_=0;d===e.id&&o==="work"&&l&&(_=(s.workDuration*60-f)/60,_>=s.workDuration&&s.workDuration>0?_=s.workDuration-1/60:_<0&&(_=0));for(let O=0;O<c;O++)O===0?a+=Math.max(0,s.workDuration-_):a+=s.workDuration,O<c-1&&(g++,g>=s.cyclesBeforeLongBreak?(a+=s.longBreakDuration,g=0):a+=s.shortBreakDuration);const re=new Date(Date.now()+a*60*1e3),fe={day:"2-digit",month:"2-digit"};return re.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})+", "+re.toLocaleDateString("vi-VN",fe)},D=d?v.find(e=>e.id===d):null,K=v.filter(e=>e.status==="in_progress").sort(B),F=v.filter(e=>e.status==="completed").sort(B);return t.jsxs("div",{className:`max-w-xl mx-auto p-4 sm:p-6 rounded-2xl shadow-xl transition-all duration-300 ease-in-out relative
             ${u?"bg-black min-h-[380px] sm:min-h-[420px] flex flex-col justify-center items-center":"bg-gray-50 dark:bg-gray-800"}`,onMouseEnter:()=>{u&&V(!0)},onMouseLeave:()=>{u&&V(!1)},children:[t.jsx(P,{children:!u&&t.jsx(S.div,{initial:{opacity:1},exit:{opacity:0},className:"mb-4 text-center",children:t.jsxs("button",{onClick:()=>h(!0),className:"inline-flex items-center text-sm text-gray-500 dark:text-gray-400 hover:text-purple-600 dark:hover:text-purple-400 transition-colors py-1.5 px-2.5 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700 border border-transparent hover:border-gray-200 dark:hover:border-gray-600",children:[t.jsx(ye,{size:15,className:"mr-1.5"}),"Cài đặt Timer"]})})}),t.jsxs("div",{className:`text-center transition-opacity duration-300 ${n?"opacity-10 pointer-events-none":"opacity-100"}`,children:[t.jsx(P,{mode:"wait",children:t.jsx(S.h2,{initial:{opacity:0,y:u?0:-10},animate:{opacity:u?0:1,y:0},exit:{opacity:0,y:u?0:10},transition:{duration:.25},className:`text-3xl sm:text-4xl font-bold mb-2
                            ${u?"h-0 overflow-hidden pointer-events-none":o==="work"?"text-gray-800 dark:text-gray-100":o==="short_break"?"text-green-600 dark:text-green-400":"text-blue-600 dark:text-blue-400"}`,children:o==="work"?"Thời Gian Tập Trung":o==="short_break"?"Nghỉ Ngắn":"Nghỉ Dài"},o)}),t.jsx("div",{className:`text-6xl font-mono font-bold mb-4 ${u?"text-white":"text-purple-600 dark:text-purple-400"}`,children:he(f)}),t.jsxs("div",{className:`flex justify-center space-x-3 sm:space-x-4 mb-6 transition-opacity duration-300
                     ${u&&!oe?"opacity-0 pointer-events-none":"opacity-100"}`,children:[t.jsx("button",{onClick:l?de:le,disabled:!l&&o==="work"&&!d,className:`p-3 rounded-full text-white transition-all duration-200 ease-in-out transform hover:scale-105
                       ${l?"bg-red-500 hover:bg-red-600 shadow-md":"bg-purple-600 hover:bg-purple-700 shadow-md"}
                       ${!l&&o==="work"&&!d?"opacity-50 cursor-not-allowed":""}
                       ${u?l?"bg-red-500/70 hover:bg-red-600/90":"bg-purple-600/70 hover:bg-purple-500/90":""}
                      `,title:!l&&o==="work"&&!d?"Vui lòng chọn công việc":l?"Tạm dừng":"Bắt đầu",children:l?t.jsx(be,{size:24}):t.jsx(ke,{size:24})}),t.jsx("button",{onClick:ue,className:`p-3 rounded-full transition-colors transform hover:scale-105 shadow-sm
                       ${u?"bg-gray-600/60 hover:bg-gray-500/80 text-gray-200":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"}
                      `,children:t.jsx(Ie,{size:24})}),o!=="work"&&!l&&t.jsx("button",{onClick:me,className:`p-3 rounded-full text-white transition-colors transform hover:scale-105 shadow-sm
                         ${u?"bg-amber-600/60 hover:bg-amber-500/80":"bg-amber-500 hover:bg-amber-600"}
                        `,children:t.jsx(Ee,{size:24})})]})]}),u&&D&&t.jsxs("div",{className:"mt-4 sm:mt-6 text-center absolute bottom-6 left-1/2 -translate-x-1/2 w-full px-4",children:[t.jsx("p",{className:"text-lg sm:text-xl text-white font-semibold truncate",title:D.name,children:D.name}),t.jsxs("p",{className:"text-xs sm:text-sm text-gray-400 mt-1",children:[D.cyclesCompleted," / ",D.estimatedCycles," sessions - Dự kiến: ",te(D)]})]}),t.jsxs("div",{className:`border-t border-gray-200 dark:border-gray-700 pt-6 mt-4 transition-opacity duration-300 ${u||n?"opacity-10 pointer-events-none h-0 overflow-hidden":"opacity-100"}`,children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-200",children:"Công việc của bạn"}),!x&&t.jsx("button",{onClick:()=>b(!0),className:"p-1.5 text-purple-600 dark:text-purple-400 hover:bg-purple-100 dark:hover:bg-gray-700 rounded-full transition-colors",title:"Thêm công việc mới",children:t.jsx(De,{size:20})})]}),t.jsx(P,{children:x&&t.jsxs(S.form,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},onSubmit:e=>{e.preventDefault(),ge()},className:"flex flex-col sm:flex-row gap-2 mb-4 items-end p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 shadow-sm",children:[t.jsxs("div",{className:"flex-1 w-full sm:w-auto",children:[t.jsx("label",{htmlFor:"newTaskName",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-0.5",children:"Tên công việc"}),t.jsx("input",{type:"text",id:"newTaskName",value:U,onChange:e=>W(e.target.value),placeholder:"Thêm công việc mới...",className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-purple-500 dark:focus:border-purple-400 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100"})]}),t.jsxs("div",{className:"w-full sm:w-20",children:[t.jsx("label",{htmlFor:"newTaskCycles",className:"block text-xs font-medium text-gray-600 dark:text-gray-300 mb-0.5",children:"Cycles"}),t.jsx("input",{type:"number",id:"newTaskCycles",min:"1",value:H,onChange:e=>Q(Number(e.target.value)),className:"w-full px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-1 focus:ring-purple-500 dark:focus:ring-purple-400 focus:border-purple-500 dark:focus:border-purple-400 text-sm bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-100"})]}),t.jsxs("div",{className:"flex gap-2 w-full sm:w-auto mt-2 sm:mt-0",children:[t.jsxs("button",{type:"submit",className:"flex-1 sm:flex-none px-3 py-1.5 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors self-end h-[34px] text-sm flex items-center justify-center gap-1",children:[t.jsx(Le,{size:16})," Lưu"]}),t.jsxs("button",{type:"button",onClick:()=>b(!1),className:"flex-1 sm:flex-none px-3 py-1.5 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors self-end h-[34px] text-sm flex items-center justify-center gap-1",children:[t.jsx(Te,{size:16})," Hủy"]})]})]})}),K.length>0&&t.jsx("div",{className:"text-sm mb-2 text-gray-500 dark:text-gray-400 font-medium",children:"Đang thực hiện:"}),t.jsxs("div",{className:"space-y-2",children:[K.length===0&&F.length===0&&!x&&t.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 text-center py-3 italic",children:"Chưa có công việc nào. Nhấn + để thêm."}),K.map(e=>t.jsxs("div",{className:`p-3 rounded-lg border transition-all duration-200 
                ${d===e.id?"bg-purple-50 dark:bg-purple-900/30 border-purple-500 dark:border-purple-600 shadow-lg ring-1 ring-purple-500 dark:ring-purple-600":"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2.5 flex-1 min-w-0",children:[t.jsx("button",{onClick:()=>ee(e.id),className:"p-1.5 rounded-full transition-colors flex-shrink-0 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-500 dark:text-gray-400",children:t.jsx(ae,{size:14})}),t.jsx("span",{className:"text-sm truncate text-gray-800 dark:text-gray-100",title:e.name,children:e.name})]}),t.jsx("button",{onClick:()=>{e.status==="in_progress"&&$(d===e.id?null:e.id)},disabled:e.status!=="in_progress",className:`px-2.5 py-1 rounded-full text-xs font-medium transition-all whitespace-nowrap ${d===e.id?"bg-purple-600 text-white shadow-sm":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-purple-100 dark:hover:bg-purple-800/50 hover:text-purple-700 dark:hover:text-purple-300"}`,children:d===e.id?"Đang làm":"Chọn làm"})]}),t.jsxs("div",{className:"mt-2.5 flex flex-col sm:flex-row items-start sm:items-center justify-between text-xs text-gray-500 dark:text-gray-400 pl-9 space-y-1 sm:space-y-0",children:[t.jsxs("span",{className:"flex items-center",title:"Số chu kỳ đã hoàn thành / Số chu kỳ dự kiến",children:[t.jsx(se,{size:14,className:"mr-1 text-blue-500 dark:text-blue-400 flex-shrink-0"}),e.cyclesCompleted," / ",e.estimatedCycles," cycles"]}),e.status==="in_progress"&&e.estimatedCycles>e.cyclesCompleted&&t.jsxs("span",{className:"flex items-center",title:"Thời gian dự kiến hoàn thành",children:[t.jsx(ne,{size:14,className:"mr-1 text-orange-500 dark:text-orange-400 flex-shrink-0"}),"Dự kiến: ",te(e)]})]})]},e.id))]}),F.length>0&&t.jsxs("div",{className:"mt-5 pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("button",{onClick:()=>ce(!q),className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-purple-600 dark:hover:text-purple-400 flex items-center w-full justify-between py-1",children:[t.jsxs("span",{children:["Công việc đã hoàn thành (",F.length,")"]}),t.jsx(we,{size:18,className:`transition-transform ${q?"rotate-180":""}`})]}),t.jsx(P,{children:q&&t.jsx(S.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden mt-2 space-y-2",children:F.map(e=>t.jsxs("div",{className:"p-3 rounded-lg border opacity-70 bg-gray-100 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700/50",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-2.5 flex-1 min-w-0",children:[t.jsx("button",{onClick:()=>ee(e.id),className:"p-1.5 rounded-full transition-colors flex-shrink-0 bg-green-500 hover:bg-green-600 text-white",children:t.jsx(ae,{size:14})}),t.jsx("span",{className:"text-sm truncate line-through text-gray-500 dark:text-gray-400",title:e.name,children:e.name})]}),t.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 cursor-default whitespace-nowrap",children:"Đã xong"})]}),t.jsxs("div",{className:"mt-2 flex items-center text-xs text-gray-400 dark:text-gray-500 pl-9",children:[t.jsx(se,{size:14,className:"mr-1 text-blue-400 dark:text-blue-500 flex-shrink-0"}),"Hoàn thành ",e.cyclesCompleted," / ",e.estimatedCycles," cycles"]})]},e.id))})})]})]}),t.jsx("audio",{ref:p,loop:!1}),t.jsx("audio",{ref:j}),t.jsx(Oe,{isOpen:n,onClose:()=>h(!1),currentSettings:s,onSaveSettings:e=>{const r={...s};if(w(e),p.current&&(r.includeMusic&&!e.includeMusic&&!p.current.paused&&p.current.pause(),e.includeMusic&&r.currentMusicTrackIndex!==e.currentMusicTrackIndex)){const c=I[e.currentMusicTrackIndex];c&&(p.current.src=new URL(c.src,window.location.origin).href,l&&o==="work"&&G.current&&p.current.play().catch(a=>console.error("Error playing new track:",a)))}}}),N&&t.jsx(Pe,{isOpen:!!N,taskName:N.name,onMarkAsCompleted:xe,onDeletePermanently:pe,onCancel:()=>z(null)})]})},Je=()=>{const[k,s]=i.useState(!1);return t.jsx("div",{className:`min-h-screen py-12 sm:py-16 md:py-20 transition-colors duration-300 ease-in-out
                  ${k?"bg-black":"bg-gradient-to-br from-purple-50 via-white to-blue-50"}`,children:t.jsxs("div",{className:"container mx-auto px-4",children:[t.jsx("div",{className:`text-center mb-8 sm:mb-10 transition-opacity duration-300 ${k?"opacity-0 h-0 overflow-hidden pointer-events-none":"opacity-100"}`,children:t.jsxs("div",{className:"relative max-w-xl mx-auto",children:[t.jsxs(ve,{to:"/",className:"absolute left-0 top-1/2 -translate-y-1/2 flex items-center text-xs sm:text-sm text-purple-600 hover:text-purple-800 transition-colors group py-2 pr-2",children:[t.jsx(je,{size:16,className:"mr-1 transition-transform group-hover:-translate-x-0.5"}),"Trang chủ"]}),t.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-gray-800",children:"Timer Block"})]})}),t.jsx(Ue,{setIsPageInFocusMode:s})]})})};export{Je as default};
